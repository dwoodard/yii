Felhantering
============

Yii tillhandahåller ett komplett felhanteringsramverk baserat på 
exception-mekanismen i PHP 5. När en applikation skapas för att hantera en 
inkommen request från användare, registrerar den sin metod 
[handleError|CApplication::handleError] för hantering av PHP:s varningar och 
påpekanden; och den registrerar sin metod 
[handleException|CApplication::handleException] för hantering av icke-uppfångade 
PHP-exception. Därför, om en varning eller ett påpekande från PHP eller en icke-
uppfångad exception uppstår när applikationen körs, kommer en av felhanterarna 
att ta över kontrollen och starta den nödvändiga felhanteringsproceduren.

> Tip|Tips: Registreringen av felhanterare sker i applikationens konstruktor 
genom anrop till PHP-funktionerna 
[set_exception_handler](http://www.php.net/manual/en/function.set-exception-handler.php) 
och [set_error_handler](http://www.php.net/manual/en/function.set-error-handler.php). 
Om det inte skulle vara önskvärt att Yii hanterar fel och 
exception, kan konstanterna `YII_ENABLE_ERROR_HANDLER` respektive 
`YII_ENABLE_EXCEPTION_HANDLER` sättas till false i 
[startskriptet](/doc/guide/basics.entry).

Som standard, signalerar [errorHandler|CApplication::errorHandler] (eller 
[exceptionHandler|CApplication::exceptionHandler]) en [onError|CApplication::onError]-händelse 
(eller [onException|CApplication::onException]-händelse). Om fel (eller 
exception respektive) inte fångas upp av någon händelsehanterare, kommer 
applikationskomponenten [errorHandler|CErrorHandler] att konsulteras.

Signalera exception
-------------------

Att signalera en exception i Yii avviker inte från att signalera en normal 
PHP-exception. Man använder följande syntax för att signalera en exception när så 
erfordras:

~~~
[php]
throw new ExceptionClass('ExceptionMessage');
~~~

Yii definierar två exception-klasser: [CException] och [CHttpException]. Den 
förra är en generell exception-klass, medan den senare representerar en 
exception skall presenteras för slutanvändare. Den senare bär också med sig en 
[statusCode|CHttpException::statusCode]-property representerande en HTTP-
statuskod. En exceptions klass avgör hur den skall presenteras, som härnäst 
förklaras.

> Tip|Tips: Att signalera en [CHttpException] är ett enkelt sätt att rapportera 
> handhavandefel av användare. Till exempel, om användaren levererar ett ogiltigt 
> post-ID i URL:en, kan vi helt enkelt göra följande för att presentera ett 
> 404-felmedelande (sidan hittades inte): 
> ~~~ 
> [php] 
> // if post ID is invalid 
> throw new CHttpException(404,'The specified post cannot be found.'); 
> ~~~ 

Presentera felmeddelanden
-------------------------

När ett fel skickas vidare till applikationskomponenten [CErrorHandler], väljer 
denna en passande vy för presentation av felmeddelandet. Om det är meningen att 
felmeddelandet skall visas för slutanvändare, som en [CHttpException], kommer 
vyn `errorXXX` att användas, där `XXX` står för HTTP-statuskoden (t.ex. 400, 
404, 500). Om felet är ett internt sådant och bara skall presenteras för 
utvecklare, kommer vyn `exception` att användas. I det senare fallet presenteras 
en komplett anropsstack såväl som information om raden där felet uppstod.

> Info: När applikationen körs i 
[produktionsläge](/doc/guide/basics.entry#debug-mode), kommer alla fel, 
inklusive de interna att presenteras med hjälp av vyn `errorXXX`. Detta beror på 
att anropsstacken vid ett fel kan innehålla känslig information. I detta fall, 
kan utvecklare ta hjälp av felloggar för att avgöra vad som är den verkliga 
anledningen till problemet.

[CErrorHandler] söker efter en vyfil till motsvarande vy i följande ordning:

   1. `WebRoot/themes/ThemeName/views/system`: detta är katalogen för `system`-vyer 
   under det för närvarande aktiva temat.

   2. `WebRoot/protected/views/system`: detta är standardkatalogen för `system`-vyer 
   i en applikation.

   3. `yii/framework/views`: detta är standardkatalogen för systemvyer som Yii-ramverket 
   tillhandahåller.

Vi kan därför. om vi vill använda anpassade felmeddelanden, helt enkelt skapa 
vyfiler med felmeddelanden i applikationens alternativt temats katalog med 
systemvyer. Varje vyfil är ett vanligt PHP-skript, huvudsakligen innehållande 
HTML-kod. För fler detaljer, studera standardvyfilerna under ramverkets `view`-
katalog.

Meddelandeloggning
------------------

Ett meddelande med nivån `error` kommer alltid att loggas när ett fel uppstår. 
Om felet orsakas av en PHP-varning eller d:o påpekande, kommer meddelandet att 
loggas med katergorin `php`; om felet orsakas av en icke-uppfångad exception, 
kommer kategorin att vara `exception.ExceptionClassName` (för [CHttpException] 
kommer dess [statusCode|CHttpException::statusCode] också att läggas till dess 
kategori). Man kan därför dra fördel av finessen 
[loggning](/doc/guide/topics.logging) till att monitorera fel som inträffat när 
applikationen kördes.

<div class="revision">$Id: topics.error.txt 772 2009-02-28 18:23:17Z qiang.xue $</div>